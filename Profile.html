<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Student Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            navy: "#1e3a8a",
            teal: "#0d9488",
            aqua: "#06b6d4",
            accent: "#f59e0b",
            neutral: "#f8fafc",
            dark: "#0f172a"
          }
        }
      }
    }
  </script>
</head>
<body class="bg-neutral min-h-screen font-sans">

  <!-- Profile Header -->
  <section class="relative w-full max-w-6xl mx-auto shadow-lg rounded-2xl overflow-hidden mb-12">
    <div class="h-40 bg-gradient-to-r from-sky-100 via-blue-50 to-green-100"></div>

    <div class="p-8 flex flex-col md:flex-row items-center gap-8 -mt-20">
      <div class="relative">
        <img src="https://ui-avatars.com/api/?background=0d9488&color=fff&name=Student"
             alt="Profile Photo"
             class="w-36 h-36 rounded-full border-4 border-white shadow-lg"/>
      </div>
      <div class="flex-1 text-center md:text-left">
        <h2 id="profile-name" class="text-2xl font-bold text-dark">Loading...</h2>
        <p id="profile-email" class="text-gray-500">Loading...</p>
        <button id="edit-btn" class="mt-4 px-6 py-2 bg-teal text-white font-semibold rounded-lg shadow hover:bg-navy transition">
          Edit Profile
        </button>
        <button id="save-btn" class="mt-4 ml-2 px-6 py-2 bg-navy text-white font-semibold rounded-lg shadow hover:bg-teal transition hidden">
          Save
        </button>
      </div>
    </div>
  </section>

  <!-- Profile Details -->
  <section class="max-w-4xl mx-auto bg-white shadow rounded-xl p-6 mb-12">
    <h3 class="text-lg font-semibold text-dark mb-6">Student Information</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- Birthdate -->
      <div class="flex items-start gap-3 p-4 rounded-lg bg-neutral/50 hover:bg-neutral/80 transition">
        <span class="text-xl">üìÖ</span>
        <div class="flex-1">
          <p class="text-sm text-gray-500">Birthdate</p>
          <p id="profile-birthdate" class="font-medium text-gray-800">--</p>
          <input id="input-birthdate" type="date" class="hidden mt-2 border rounded px-2 py-1 w-full"/>
        </div>
      </div>

      <!-- Age -->
      <div class="flex items-start gap-3 p-4 rounded-lg bg-neutral/50 hover:bg-neutral/80 transition">
        <span class="text-xl">üéÇ</span>
        <div class="flex-1">
          <p class="text-sm text-gray-500">Age</p>
          <p id="profile-age" class="font-medium text-gray-800">--</p>
          <input id="input-age" type="number" min="1" class="hidden mt-2 border rounded px-2 py-1 w-full"/>
        </div>
      </div>

      <!-- Contact -->
      <div class="flex items-start gap-3 p-4 rounded-lg bg-neutral/50 hover:bg-neutral/80 transition">
        <span class="text-xl">üìû</span>
        <div class="flex-1">
          <p class="text-sm text-gray-500">Contact</p>
          <p id="profile-contact" class="font-medium text-gray-800">--</p>
          <input id="input-contact" type="tel" class="hidden mt-2 border rounded px-2 py-1 w-full"/>
        </div>
      </div>

      <!-- Class -->
      <div class="flex items-start gap-3 p-4 rounded-lg bg-neutral/50 hover:bg-neutral/80 transition">
        <span class="text-xl">üè´</span>
        <div class="flex-1">
          <p class="text-sm text-gray-500">Class</p>
          <p id="profile-class" class="font-medium text-gray-800">--</p>
          <select id="input-class" class="hidden mt-2 border rounded px-2 py-1 w-full">
            <option value="">Select Class</option>
            <option value="10th">10th</option>
            <option value="12th">12th</option>
          </select>
        </div>
      </div>

      <!-- Stream -->
      <div id="stream-block" class="flex items-start gap-3 p-4 rounded-lg bg-neutral/50 hover:bg-neutral/80 transition md:col-span-2 hidden">
        <span class="text-xl">üéì</span>
        <div class="flex-1">
          <p class="text-sm text-gray-500">Stream</p>
          <p id="profile-stream" class="font-medium text-gray-800">--</p>
          <select id="input-stream" class="hidden mt-2 border rounded px-2 py-1 w-full">
            <option value="">Select Stream</option>
          </select>
        </div>
      </div>

    </div>
  </section>

  <!-- Subject Progress -->
  <section class="max-w-6xl mx-auto mb-12">
    <h3 class="text-xl font-bold text-dark mb-6">Subject Progress</h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
      <!-- Progress cards (kept same as before) -->
      <div class="bg-white p-6 rounded-xl shadow flex flex-col items-center">
        <svg class="w-24 h-24 -rotate-90">
          <circle cx="48" cy="48" r="40" stroke="#e5e7eb" stroke-width="10" fill="transparent"/>
          <circle cx="48" cy="48" r="40" stroke="#0d9488" stroke-width="10" stroke-dasharray="251" stroke-dashoffset="150"/>
        </svg>
        <p class="mt-3 font-semibold">Science</p>
        <p class="text-sm text-gray-500">60% complete</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow flex flex-col items-center">
        <svg class="w-24 h-24 -rotate-90">
          <circle cx="48" cy="48" r="40" stroke="#e5e7eb" stroke-width="10" fill="transparent"/>
          <circle cx="48" cy="48" r="40" stroke="#1e3a8a" stroke-width="10" stroke-dasharray="251" stroke-dashoffset="100"/>
        </svg>
        <p class="mt-3 font-semibold">Math</p>
        <p class="text-sm text-gray-500">70% complete</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow flex flex-col items-center">
        <svg class="w-24 h-24 -rotate-90">
          <circle cx="48" cy="48" r="40" stroke="#e5e7eb" stroke-width="10" fill="transparent"/>
          <circle cx="48" cy="48" r="40" stroke="#06b6d4" stroke-width="10" stroke-dasharray="251" stroke-dashoffset="175"/>
        </svg>
        <p class="mt-3 font-semibold">English</p>
        <p class="text-sm text-gray-500">30% complete</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow flex flex-col items-center">
        <svg class="w-24 h-24 -rotate-90">
          <circle cx="48" cy="48" r="40" stroke="#e5e7eb" stroke-width="10" fill="transparent"/>
          <circle cx="48" cy="48" r="40" stroke="#f59e0b" stroke-width="10" stroke-dasharray="251" stroke-dashoffset="200"/>
        </svg>
        <p class="mt-3 font-semibold">Social Studies</p>
        <p class="text-sm text-gray-500">20% complete</p>
      </div>
    </div>
  </section>

  <!-- Scorecard -->
  <section class="max-w-6xl mx-auto bg-white shadow rounded-xl p-6 mb-12">
    <h3 class="text-xl font-bold text-dark mb-4">Scorecard</h3>
    <table class="w-full text-sm border-collapse">
      <thead>
        <tr class="text-left bg-neutral text-navy">
          <th class="py-2 px-3">Subject</th>
          <th class="py-2 px-3">Marks</th>
          <th class="py-2 px-3">Total</th>
          <th class="py-2 px-3">Grade</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-b hover:bg-neutral/70">
          <td>Science</td><td>84</td><td>100</td>
          <td><span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs">A</span></td>
        </tr>
        <tr class="border-b hover:bg-neutral/70">
          <td>Math</td><td>75</td><td>100</td>
          <td><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">B+</span></td>
        </tr>
        <tr class="border-b hover:bg-neutral/70">
          <td>English</td><td>68</td><td>100</td>
          <td><span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs">B</span></td>
        </tr>
        <tr>
          <td>Social Studies</td><td>50</td><td>100</td>
          <td><span class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs">C</span></td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- Download Report -->
  <section class="w-full max-w-6xl mx-auto bg-gradient-to-r from-navy via-teal to-aqua text-white shadow rounded-xl p-8 flex flex-col md:flex-row items-center justify-between gap-6">
    <div class="flex items-center gap-4">
      üìÑ
      <div>
        <h3 class="text-xl font-bold">Download Your Progress Report</h3>
        <p class="text-sm text-gray-200">Get a PDF summary of your academic results and share it with your parents or teachers.</p>
      </div>
    </div>
    <button id="download-btn" class="px-6 py-3 bg-white text-navy rounded-lg font-bold shadow hover:bg-neutral transition">Download PDF</button>
  </section>
  <!--Footer -->
<footer class="bg-gray-800 text-white rounded-lg p-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-4">Disha J&K</h3>
                    <p class="text-gray-400">Empowering the youth of Jammu & Kashmir with career guidance and educational resources.</p>
                </div>
                
                <div>
                    <h3 class="text-lg font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">About Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Contact</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Terms of Service</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-bold mb-4">Resources</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">Career Assessment</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Scholarships</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">College Directory</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Success Stories</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-bold mb-4">Connect With Us</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
                <p>&copy; 2025 Disha J&K. All rights reserved. An initiative for Smart India Hackathon 2025.</p>
            </div>
        </footer>
    </div>
  <!-- Script -->
  <script>
    async function loadProfile() {
      // Get logged-in email from localStorage
      const email = localStorage.getItem("studentEmail");
      if (!email) {
        window.location.href = "Login.html";
        return;
      }

      // Fetch profile from backend
      const res = await fetch("http://localhost:5000/profile?email=" + encodeURIComponent(email));
      const data = await res.json();

      if (data.success) {
        document.getElementById("profile-name").textContent = data.user.name;
        document.getElementById("profile-email").textContent = data.user.email;
        document.getElementById("profile-birthdate").textContent = data.user.birthdate || "--";
        document.getElementById("profile-age").textContent = data.user.age || "--";
        document.getElementById("profile-contact").textContent = data.user.contact || "--";
        document.getElementById("profile-class").textContent = data.user.class || "--";
        document.getElementById("profile-stream").textContent = data.user.stream || "--";

        toggleStreamVisibility(data.user.class);
      }
    }

    function toggleStreamVisibility(classValue) {
      const streamBlock = document.getElementById("stream-block");

      if (classValue === "12th") {
        streamBlock.classList.remove("hidden");
        const streamSelect = document.getElementById("input-stream");
        streamSelect.innerHTML = `
          <option value="">Select Stream</option>
          <option value="Science">Science</option>
          <option value="Commerce">Commerce</option>
          <option value="Arts">Arts</option>
          <option value="Vocational">Vocational</option>
        `;
      } else {
        streamBlock.classList.add("hidden");
      }
    }

    function toggleEditMode(editing) {
      const fields = ["birthdate", "age", "contact", "class", "stream"];
      fields.forEach(field => {
        const profileField = document.getElementById("profile-" + field);
        const inputField = document.getElementById("input-" + field);
        if (!profileField || !inputField) return;

        profileField.classList.toggle("hidden", editing);
        inputField.classList.toggle("hidden", !editing);

        if (editing) {
          inputField.value = profileField.textContent !== "--" ? profileField.textContent : "";
        }
      });

      document.getElementById("edit-btn").classList.toggle("hidden", editing);
      document.getElementById("save-btn").classList.toggle("hidden", !editing);
    }

    document.getElementById("edit-btn").addEventListener("click", () => toggleEditMode(true));

    document.getElementById("save-btn").addEventListener("click", async () => {
      const updatedData = {
        email: localStorage.getItem("studentEmail"),
        birthdate: document.getElementById("input-birthdate").value,
        age: document.getElementById("input-age").value,
        contact: document.getElementById("input-contact").value,
        class: document.getElementById("input-class").value,
        stream: document.getElementById("input-stream").value
      };

      // Save to backend
      const res = await fetch("http://localhost:5000/profile", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updatedData)
      });

      const data = await res.json();
      if (data.success) {
        toggleEditMode(false);
        loadProfile();
      } else {
        alert("Failed to update profile!");
      }
    });

    // Download Report
    document.getElementById("download-btn").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(16);
      doc.text("Student Progress Report", 20, 20);

      doc.setFontSize(12);
      doc.text(`Name: ${document.getElementById("profile-name").textContent}`, 20, 40);
      doc.text(`Email: ${document.getElementById("profile-email").textContent}`, 20, 50);
      doc.text(`Birthdate: ${document.getElementById("profile-birthdate").textContent}`, 20, 60);
      doc.text(`Age: ${document.getElementById("profile-age").textContent}`, 20, 70);
      doc.text(`Contact: ${document.getElementById("profile-contact").textContent}`, 20, 80);
      doc.text(`Class: ${document.getElementById("profile-class").textContent}`, 20, 90);
      doc.text(`Stream: ${document.getElementById("profile-stream").textContent}`, 20, 100);

      doc.text("Marks:", 20, 120);
      doc.text("Science: 84/100 (A)", 30, 130);
      doc.text("Math: 75/100 (B+)", 30, 140);
      doc.text("English: 68/100 (B)", 30, 150);
      doc.text("Social Studies: 50/100 (C)", 30, 160);

      doc.save("Progress_Report.pdf");
    });

    window.addEventListener("DOMContentLoaded", loadProfile);
  </script>
</body>
</html>
